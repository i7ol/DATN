<header
  class="sticky top-0 z-50 bg-white transition-shadow duration-300"
  [class.shadow-md]="isScrolled"
>
  <div class="max-w-screen-xl mx-auto px-6 lg:px-20 py-4 poppins-medium">
    <!-- TOP BAR -->
    <div
      class="flex items-center justify-between border-b border-gray-100 pb-3"
    >
      <!-- LEFT -->
      <div class="flex items-center gap-6 text-sm text-gray-600">
        <div class="flex items-center gap-2">
          <img src="./assets/img/location.png" class="w-4 h-4 opacity-70" />
          <span>Việt Nam</span>
        </div>
        <span class="text-gray-300">|</span>
        <div class="flex items-center gap-2">
          <img src="./assets/img/phone-call.png" class="w-4 h-4 opacity-70" />
          <span>0398 287 981</span>
        </div>
      </div>

      <!-- CENTER -->
      <div class="text-xl font-semibold tracking-widest text-gray-900">
        WUKONG
      </div>

      <!-- RIGHT -->
      <div class="flex items-center gap-6 text-sm text-gray-600">
        <!-- SEARCH -->
        <div class="cursor-pointer hover:text-black transition">
          <img src="./assets/img/search.png" class="w-4 h-4 opacity-70" />
        </div>

        <!-- ACCOUNT -->
        <div
          class="relative"
          (mouseenter)="onAccountMouseEnter()"
          (mouseleave)="onAccountMouseLeave()"
        >
          <!-- TRIGGER -->
          <div
            class="flex items-center gap-2 cursor-pointer hover:text-black transition"
            (click)="!currentUser && openLoginModal()"
          >
            <img src="./assets/img/user.png" class="w-4 h-4 opacity-70" />
            <span>{{ getDisplayName() }}</span>
          </div>

          <!-- ACCOUNT DROPDOWN -->
          <div
            *ngIf="isAccountDropdownOpen"
            class="absolute right-0 top-full mt-3 w-64 bg-white shadow-xl rounded-xl border z-50 transition-all duration-200"
            (mouseenter)="onAccountDropdownMouseEnter()"
            (mouseleave)="onAccountDropdownMouseLeave()"
          >
            <!-- NOT LOGGED IN -->
            <div *ngIf="!currentUser" class="py-4">
              <button
                (click)="openLoginModal()"
                class="w-full text-left block px-4 py-2 text-sm hover:bg-gray-100"
              >
                Đăng nhập
              </button>
              <button
                (click)="openRegisterModal()"
                class="w-full text-left block px-4 py-2 text-sm hover:bg-gray-100"
              >
                Đăng ký
              </button>
            </div>

            <!-- LOGGED IN -->
            <div *ngIf="currentUser" class="py-2">
              <!-- User Info -->
              <div class="px-4 py-2 border-b">
                <div class="flex items-center justify-between">
                  <span class="font-medium">{{ currentUser.username }}</span>
                  <span
                    *ngIf="isAdmin"
                    class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded"
                  >
                    ADMIN
                  </span>
                  <span
                    *ngIf="!isAdmin"
                    class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded"
                  >
                    USER
                  </span>
                </div>
                <div class="text-xs text-gray-500 mt-1">
                  {{ currentUser.email }}
                </div>
              </div>

              <!-- Menu Items -->
              <a
                routerLink="/profile"
                class="block px-4 py-3 text-sm hover:bg-gray-100 flex items-center gap-2"
                (click)="isAccountDropdownOpen = false"
              >
                Hồ sơ của tôi
              </a>
              <a
                routerLink="/checkout"
                class="block px-4 py-3 text-sm hover:bg-gray-100 flex items-center gap-2"
                (click)="isAccountDropdownOpen = false"
              >
                Đơn hàng của tôi
              </a>

              <div *ngIf="isAdmin" class="border-t mt-2 pt-2">
                <div
                  class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider"
                >
                  ADMIN PANEL
                </div>

                <!-- Dashboard -->
                <a
                  routerLink="/admin/dashboard"
                  class="block px-4 py-3 text-sm hover:bg-gray-100 flex items-center gap-3"
                  (click)="closeAllDropdowns()"
                >
                  <div>
                    <div class="font-medium">Dashboard</div>
                    <div class="text-xs text-gray-500 mt-0.5">
                      Tổng quan hệ thống
                    </div>
                  </div>
                </a>

                <!-- Quản lý đơn hàng -->
                <a
                  routerLink="/admin/orders"
                  class="block px-4 py-3 text-sm hover:bg-gray-100 flex items-center gap-3"
                  (click)="closeAllDropdowns()"
                >
                  <div>
                    <div class="font-medium">Quản lý đơn hàng</div>
                    <div class="text-xs text-gray-500 mt-0.5">
                      Xem và xử lý đơn hàng
                    </div>
                  </div>
                </a>

                <!-- Quản lý thanh toán -->
                <a
                  routerLink="/admin/payments"
                  class="block px-4 py-3 text-sm hover:bg-gray-100 flex items-center gap-3"
                  (click)="closeAllDropdowns()"
                >
                  <div>
                    <div class="font-medium">Quản lý thanh toán</div>
                    <div class="text-xs text-gray-500 mt-0.5">
                      Xử lý hoàn tiền, thanh toán
                    </div>
                  </div>
                </a>

                <!-- Quản lý vận chuyển -->
                <a
                  routerLink="/admin/shippings"
                  class="block px-4 py-3 text-sm hover:bg-gray-100 flex items-center gap-3"
                  (click)="closeAllDropdowns()"
                >
                  <div>
                    <div class="font-medium">Quản lý vận chuyển</div>
                    <div class="text-xs text-gray-500 mt-0.5">
                      Theo dõi đơn vận chuyển
                    </div>
                  </div>
                </a>

                <!-- Quản lý sản phẩm -->
                <a
                  routerLink="/admin/products-admin"
                  class="block px-4 py-3 text-sm hover:bg-gray-100 flex items-center gap-3"
                  (click)="closeAllDropdowns()"
                >
                  <div>
                    <div class="font-medium">Quản lý sản phẩm</div>
                    <div class="text-xs text-gray-500 mt-0.5">
                      Thêm, sửa, xóa sản phẩm
                    </div>
                  </div>
                </a>

                <!-- Quản lý tồn kho -->
                <a
                  routerLink="/admin/inventory"
                  class="block px-4 py-3 text-sm hover:bg-gray-100 flex items-center gap-3"
                  (click)="closeAllDropdowns()"
                >
                  <div>
                    <div class="font-medium">Quản lý tồn kho</div>
                    <div class="text-xs text-gray-500 mt-0.5">
                      Theo dõi số lượng tồn
                    </div>
                  </div>
                </a>
              </div>

              <!-- Logout -->
              <div class="border-t mt-2">
                <button
                  (click)="logout()"
                  class="w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2"
                >
                  Đăng xuất
                </button>
              </div>
            </div>
          </div>
        </div>

        <span class="text-gray-300">|</span>

        <!-- CART -->
        <div
          class="relative"
          (mouseenter)="onCartMouseEnter()"
          (mouseleave)="onCartMouseLeave()"
        >
          <!-- TRIGGER -->
          <div
            class="flex items-center gap-2 cursor-pointer font-medium hover:text-black"
          >
            <a routerLink="/cart" class="text-sm font-medium">Giỏ hàng</a>
            <div class="relative">
              <img src="./assets/img/cart.png" class="w-4 h-4 opacity-70" />
              <span
                *ngIf="cartTotalQuantity > 0"
                class="absolute -top-1 -right-2 w-4 h-4 flex items-center justify-center text-[10px] bg-red-500 text-white rounded-full"
              >
                {{ cartTotalQuantity }}
              </span>
            </div>
          </div>

          <!-- CART DROPDOWN -->
          <div
            *ngIf="isCartHover"
            class="absolute right-0 top-full mt-3 w-96 bg-white shadow-xl rounded-xl border z-50 transition-all duration-200"
            (mouseenter)="onDropdownMouseEnter()"
            (mouseleave)="onDropdownMouseLeave()"
          >
            <!-- Loading State -->
            <div *ngIf="cartLoading" class="py-6 text-center">
              <div
                class="animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 mx-auto"
              ></div>
              <p class="text-sm text-gray-500 mt-2">Đang tải giỏ hàng...</p>
            </div>

            <!-- Empty Cart -->
            <div
              *ngIf="!cartLoading && cartItems.length === 0"
              class="py-10 flex flex-col items-center gap-4 text-gray-500"
            >
              <img
                src="./assets/img/empty-cart.webp"
                class="w-32 opacity-80"
                alt="Giỏ hàng trống"
              />
              <p class="text-sm">Giỏ hàng của bạn đang trống</p>
              <button
                routerLink="/products"
                class="px-6 py-2 bg-black text-white rounded hover:bg-gray-800 transition text-sm"
                (click)="isCartHover = false"
              >
                Tiếp tục mua sắm
              </button>
            </div>

            <!-- Cart Items -->
            <div *ngIf="!cartLoading && cartItems.length > 0">
              <!-- Header -->
              <div class="px-4 py-3 border-b">
                <div class="flex items-center justify-between">
                  <h3 class="font-semibold text-sm">Giỏ hàng của bạn</h3>
                  <span class="text-xs text-gray-500">
                    {{ cartTotalQuantity }} sản phẩm
                  </span>
                </div>
              </div>

              <!-- Items List -->
              <div class="max-h-80 overflow-y-auto px-4 py-2">
                <div
                  *ngFor="let item of cartItems"
                  class="flex gap-3 py-3 border-b last:border-0 hover:bg-gray-50 transition-colors"
                >
                  <!-- Product Image -->
                  <div class="flex-shrink-0">
                    <img
                      [src]="item.images?.[0]?.url || '/assets/img/no-image.png'"
                      [alt]="item.productName"
                      class="w-16 h-16 object-cover rounded border"
                      onerror="this.src='/assets/img/no-image.png'"
                    />
                  </div>

                  <!-- Product Info -->
                  <div class="flex-1 min-w-0">
                    <h4 class="text-sm font-medium line-clamp-2 mb-1">
                      {{ item.productName }}
                    </h4>
                    <div class="text-xs text-gray-500 mb-1">
                      Màu: {{ item.color || "N/A" }}
                      <span *ngIf="item.sizeName">
                        • Size: {{ item.sizeName }}</span
                      >
                    </div>
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-600">
                        {{ item.quantity }} ×
                        {{ item.price | number : "1.0-0" }}đ
                      </span>
                      <span class="text-sm font-semibold">
                        {{ item.quantity * item.price | number : "1.0-0" }}đ
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Footer -->
              <div class="border-t px-4 py-3 bg-gray-50">
                <!-- Total -->
                <div class="flex justify-between items-center mb-3">
                  <span class="text-sm font-semibold">Tổng tiền:</span>
                  <span class="text-lg font-bold text-red-600">
                    {{ cartTotalPrice | number : "1.0-0" }}đ
                  </span>
                </div>

                <!-- Buttons -->
                <div class="flex gap-2">
                  <button
                    routerLink="/cart"
                    class="flex-1 py-2 bg-black text-white rounded hover:bg-gray-800 transition text-sm font-medium"
                    (click)="isCartHover = false"
                  >
                    Xem giỏ hàng
                  </button>
                  <button
                    routerLink="/checkout"
                    class="flex-1 py-2 border border-gray-300 rounded hover:bg-gray-100 transition text-sm font-medium"
                    (click)="isCartHover = false"
                    [disabled]="cartTotalPrice === 0"
                    [ngClass]="{
                      'opacity-50 cursor-not-allowed': cartTotalPrice === 0
                    }"
                  >
                    Thanh toán
                  </button>
                </div>

                <!-- Free Shipping Notice -->
                <div
                  *ngIf="cartTotalPrice < 500000"
                  class="mt-2 text-xs text-center text-gray-600"
                >
                  <span class="text-red-500">*</span>
                  Mua thêm {{ 500000 - cartTotalPrice | number : "1.0-0" }}đ để
                  được miễn phí vận chuyển
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MENU -->
    <div
      class="flex items-center justify-center gap-10 pt-3 text-sm tracking-wide text-gray-600"
    >
      <a
        routerLink="/"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        class="menu-item relative cursor-pointer"
      >
        Trang chủ <span class="menu-line"></span>
      </a>
      <a
        routerLink="/products"
        routerLinkActive="active"
        class="menu-item relative cursor-pointer"
      >
        Sản phẩm <span class="menu-line"></span>
      </a>
      <a
        routerLink="/blog"
        routerLinkActive="active"
        class="menu-item relative cursor-pointer"
      >
        Blog <span class="menu-line"></span>
      </a>
      <a
        routerLink="/contact"
        routerLinkActive="active"
        class="menu-item relative cursor-pointer"
      >
        Liên hệ <span class="menu-line"></span>
      </a>
    </div>
  </div>
</header>
